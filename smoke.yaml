command:
  - trunkver
  - --timestamp
  - "2024-05-22T16:25:48+02:00"

tests:
  - name: simple
    args:
      - --source-ref
      - "g1234567"
      - --build-ref
      - "R4242"
    stdout: |
      20240522142548.0.0-g1234567-R4242

  - name: prerelease
    args:
      - --source-ref
      - "g1234567"
      - --build-ref
      - "R4242"
      - --prerelease
    stdout: |
      -20240522142548-g1234567-R4242

  - name: panic/if-no-build-ref
    args:
      - --source-ref
      - "g1234567"
    exit-status: 1
    stderr: |
      Error: --build-ref missing, your CI might be unsupported. Specify it manually. It should identify the log that was produced during creation of this artifact, e.g. the Job Id in Github Actions

  - name: panic/if-no-source-ref
    args:
      - --build-ref
      - "1234567"
    exit-status: 1
    stderr: |
      Error: --source-ref missing, your CI might be unsupported. Specify it manually. It should identify the commit that was used to build this artifact, e.g. "g${GITHUB_SHA:0:7}" or "g$(git rev-parse --short HEAD)".

  - name: ci/github
    command: |
      export GITHUB_SHA=1234567890abcdef1234567890abcdef12345678
      export GITHUB_RUN_ID=GITHUBRUN
      trunkver --timestamp "2024-05-22T16:25:48+02:00"
    stdout: |
      20240522142548.0.0-g1234567-GITHUBRUN

  - name: ci/gitlab
    command: |
      export GITLAB_CI=true
      export CI_COMMIT_SHA=1234567890abcdef1234567890abcdef12345678
      export CI_JOB_ID=GITLABRUN
      trunkver --timestamp "2024-05-22T16:25:48+02:00"
    stdout: |
      20240522142548.0.0-g1234567-GITLABRUN

  - name: ci/circleci
    command: |
      export CIRCLECI=true
      export CIRCLE_SHA1=1234567890abcdef1234567890abcdef12345678
      export CIRCLE_WORKFLOW_JOB_ID=CIRCLECIJOB
      trunkver --timestamp "2024-05-22T16:25:48+02:00"
    stdout: |
      20240522142548.0.0-g1234567-CIRCLECIJOB
