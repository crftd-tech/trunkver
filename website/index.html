<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>trunkVer</title>
  </head>
  <style>
    document,
    body,
    window {
      font-family: "Frank Ruhl Libre", serif;
      font-size: 16px;
    }

    body {
      display: flex;
      padding: 0;
      margin: 0;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .content {
      width: 800px;
    }

    @media screen and (max-width: 800px) {
      .content {
        width: 90%;
      }
      ul {
        padding: 0;
      }
    }
    @font-face {
      font-family: "Frank Ruhl Libre";
      src: url("FrankRuhlLibre-VariableFont_wght.ttf") format("truetype");
    }
    @font-face {
      font-family: "Work Sans";
      src: url("WorkSans-Thin.ttf") format("truetype");
      font-weight: 100;
    }
    @font-face {
      font-family: "Source Code Pro";
      src: url("SourceCodePro-SemiBold.ttf") format("truetype");
      font-weight: 600;
    }

    a,
    a:hover,
    a:active,
    a:visited {
      color: #000;
      font-style: italic;
    }

    h1 {
      font-family: "Source Code Pro", monospace;
      font-weight: 600;
      font-size: 3em;
      box-shadow: inset 0 -0.5em 0 #ff8e40;
      padding: 0 0.5rem;
      box-decoration-break: clone;
      display: inline;
    }

    li h1,
    li h2,
    li h3 {
      display: inline;
    }

    .spacer {
      height: 24px;
    }

    a.btn {
      display: inline-block;
      padding: 8px 24px;
      text-decoration: none;
      border: 1px solid black;
      font-weight: 600;
      font-style: normal;
      font-family: "Source Code Pro", monospace;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2), inset 0 -0.3em 0 #ff8e40;
      transition: box-shadow 0.2s;
      &:hover {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);
      }
    }

    pre {
      background-color: #f4f4f4;

      border-radius: 0.5em;
      overflow-x: auto;
      padding: 1em;

      @media screen and (max-width: 800px) {
        font-size: 0.8em;
      }
    }

    blockquote {
      position: relative;
      p {
        &::before {
          position: absolute;
          left: -0.7em;
          content: "â€œ";
          font-size: 3em;
          color: #ff8e40;
        }
      }

      footer {
        font-style: italic;
        font-size: 0.8em;
      }
    }
    .hero {
      padding: 5px;
      background-color: #f4f4f4;
      border-radius: 0.5em;
      font-size: 2em;
      overflow-x: auto;
      table {
        width: 100%;
        min-width: 600px;
        border-collapse: collapse;

        @media screen and (max-width: 800px) {
          tr.version {
            font-size: 0.4em;
          }
          tr.description {
            font-size: 0.3em;
          }
        }
        tr {
          text-align: center;
        }

        tr.version {
          font-family: "Source Code Pro", monospace;
        }
        tr.description {
          font-style: italic;
          font-size: 0.5em;
        }
        tr.code {
          font-family: "Source Code Pro", monospace;
          font-size: 0.4em;
        }
      }
    }
  </style>
  <body>
    <div class="content">
      <h1>
        <span class="logo">trunkVer</span>
      </h1>
      <p>... so we can stop talking about versions and start shipping ðŸš€</p>
      <div class="spacer"></div>
      <div class="hero">
        <table>
          <tr class="version">
            <td>20240527125612.0.0</td>
            <td>-</td>
            <td>g13866bd</td>
            <td>-</td>
            <td>9253259568</td>
          </tr>
          <tr class="description">
            <td>When was it built</td>
            <td>&nbsp;</td>
            <td>What was built</td>
            <td>&nbsp;</td>
            <td>How was it built</td>
          </tr>
          <tr class="code">
            <td>date -u +%Y%m%d%H%M%S</td>
            <td>&nbsp;</td>
            <td>git rev-parse --short HEAD</td>
            <td>&nbsp;</td>
            <td>${CI_JOB_ID}</td>
          </tr>
        </table>
      </div>
      <h2>TL;DR</h2>
      <ul>
        <li>
          <h3>GitHub Action</h3>
          :
          <pre><code>- name: Generate trunkver
  id: trunkver
  uses: crftd-tech/trunkver@main

- name: Print trunkver
  env:
    TRUNKVER: ${{ steps.trunkver.outputs.trunkver }}
  run: |
    echo "$TRUNKVER"
</code></pre>
        </li>
        <li>
          <h3>Docker</h3>
          :
          <pre><code>docker run ghcr.io/crftd-tech/trunkver:latest --build-ref "$CI_JOB_ID" --source-ref "g$(git rev-parse --short HEAD)"</code></pre>
        </li>
        <li>
          <h3>Other CIs</h3>
          :
          <pre><code>curl -sSL https://github.com/crftd-tech/trunkver/releases/latest/download/trunkver_linux_amd64 -o trunkver
chmod +x trunkver
./trunkver</code></pre>
        </li>
      </ul>
      <h2>FAQ</h2>
      <ul>
        <li>
          <b>Why only use the MAJOR semVer part as a timestamp?</b><br />Tools
          (e.g. compliance, audit trails) might still classify a version based
          on semVer semantics, hence trunkVer always defensively implies breaking
          changes between versions.
        </li>
        <li>
          <b
            >Why do you use the PRERELEASE semVer part for source information
            and not build?</b
          ><br />Because OCI tags don't support <code>+</code> (see
          <a href="https://github.com/distribution/distribution/issues/1201"
            >distribution/distribution#1201</a
          > and <a href="https://github.com/opencontainers/distribution-spec/issues/154">opencontainers/distribution-spec#154</a>). We'd rather have one consistent version across artifacts. Semantically, the only relevant portion for sorting of a trunkVer is the MAJOR version, and a conflict (as in creating two artifacts in the very same second) should be avoided.
        </li>
      </ul>

      <footer>
        Made with ðŸ§¡ for people &amp; tech, and disregard for busy-work by
        <a href="https://crftd.tech">crafted. tech collective</a>.
      </footer>
      <small><code id="version"></code></small>
    </div>
  </body>
  <script async defer>
    window.addEventListener("DOMContentLoaded", () => {
      fetch("./version.txt")
        .then((response) => response.text())
        .then((data) => {
          document.getElementById("version").innerText = `Version: ${data}`;
        });
    });
  </script>
</html>
